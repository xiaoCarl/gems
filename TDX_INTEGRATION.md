# 通达信API集成文档

## 概述

已成功将通达信API集成到Gems系统中，作为主要的实时数据源。通达信提供稳定、快速的A股和港股实时行情数据。

## 集成架构

### 数据源层次
- **通达信数据源 (TDXDataSource)**: 主要实时数据源
- **AkShare数据源**: 主要财务数据源
- **YFinance数据源**: 备用实时数据源（主要用于港股）

### 数据获取策略
- **A股**: 优先使用通达信，其次AkShare
- **港股**: 优先使用通达信，其次YFinance

## 功能特性

### 通达信数据源优势
- ✅ **高稳定性**: 通达信服务器稳定可靠
- ✅ **低延迟**: 实时行情数据更新快
- ✅ **全面覆盖**: 支持A股和港股
- ✅ **免费使用**: 无需API密钥

### 支持的数据类型
- **实时行情数据**: 价格、成交量、涨跌幅、买卖盘等
- **A股**: 深交所(.SZ)、上交所(.SH)
- **港股**: 港交所(.HK)

## 使用示例

### 通过统一API获取实时数据
```python
from gems.api import get_realtime_stock_data

# A股示例
data = get_realtime_stock_data('000001.SZ')  # 平安银行
data = get_realtime_stock_data('600036.SH')  # 招商银行
data = get_realtime_stock_data('600519.SH')  # 贵州茅台

# 港股示例
data = get_realtime_stock_data('00700.HK')   # 腾讯控股
```

### 直接使用通达信API
```python
from gems.tools.tdx_api import get_tdx_realtime_data

data = get_tdx_realtime_data('000001.SZ')
print(f"当前价格: {data['current_price']}")
print(f"涨跌幅: {data['change_percent']:.2f}%")
```

## 数据格式

通达信返回的实时数据包含以下字段：

```python
{
    "symbol": "000001.SZ",
    "current_price": 11.4,
    "prev_close": 11.54,
    "open": 11.5,
    "high": 11.55,
    "low": 11.38,
    "volume": 12345678,
    "turnover": 140000000,
    "change": -0.14,
    "change_percent": -1.21,
    "bid_prices": [11.39, 11.38, 11.37, 11.36, 11.35],
    "bid_volumes": [1000, 2000, 3000, 4000, 5000],
    "ask_prices": [11.40, 11.41, 11.42, 11.43, 11.44],
    "ask_volumes": [1500, 2500, 3500, 4500, 5500],
    "timestamp": 1729359544,
    "update_time": "2025-10-19 21:39:04",
    "market": "A股",
    "data_source": "通达信"
}
```

## 故障转移机制

系统具有智能故障转移机制：

1. **首选通达信** - 如果通达信可用，优先使用
2. **备用数据源** - 如果通达信失败，自动切换到其他数据源
3. **错误处理** - 详细的错误日志和异常处理

## 性能表现

- **连接成功率**: 通达信服务器连接稳定
- **数据延迟**: 实时数据更新迅速
- **并发处理**: 支持多股票同时查询

## 配置说明

通达信数据源无需额外配置，系统自动检测可用性并集成到数据源管理器中。

## 注意事项

1. **网络要求**: 需要能够访问通达信服务器
2. **港股限制**: 部分港股可能无法通过通达信获取
3. **财务数据**: 通达信仅提供实时数据，财务数据仍使用AkShare

## 测试验证

已通过以下测试：
- ✅ 通达信连接测试
- ✅ A股实时数据获取
- ✅ 统一API集成测试
- ✅ gems-agent启动测试
- ✅ 多股票并发测试

## 结论

通达信API集成成功，为Gems系统提供了稳定可靠的实时数据源，显著提升了实时行情数据的获取效率和稳定性。